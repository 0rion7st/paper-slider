<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->

<!--
/**
 * @group Quantum Paper Elements
 *
 * `paper-slider` allows user to select a value from a range of values by
 * moving the slider thumb.  The interactive nature of the slider makes it a 
 * great choice for settings that reflect intensity levels, such as volume, 
 * brightness, or color saturation.
 *
 * Example:
 *
 *    <paper-slider></paper-slider>
 *
 * Use `min` and `max` to specify the slider range.  Default is 0 to 100.
 *
 * Example:
 *
 *     <paper-slider min="10" max="200" value="110"></paper-slider>
 *
 * Styling progress bar:
 *
 * To change the slider progress bar color:
 *
 *     paper-slider /shadow/ #sliderBar /shadow/ #activeProgress {
 *       background-color: #0f9d58;
 *     }
 *
 * To change the slider knob color:
 *
 *     paper-slider /shadow/ #sliderKnobInner {
 *       background-color: #0f9d58;
 *     }
 *
 * To change the slider pin color:
 *
 *     paper-slider /shadow/ #sliderKnobInner::before {
 *       background-color: #0f9d58;
 *     }
 *
 * @element paper-slider
 * @homepage github.io
 */
-->

<link rel="import" href="../paper-progress/paper-progress.html">

<polymer-element name="paper-slider" attributes="value min max step snaps pin disabled">

  <template>
  
    <link rel="stylesheet" href="paper-slider.css">
    <link rel="stylesheet" href="../core-layout/core-layout.css">

    <div id="sliderContainer" touch-action="pan-y">
    
      <paper-progress id="sliderBar" min="{{min}}" max="{{max}}" value="{{_value}}" on-tap="{{barTap}}"></paper-progress>
      
      <div core-flow class="slider-markers {{ {hidden : !snaps} | tokenList }}">
        <template repeat="{{markers}}">
          <div core-flex class="slider-marker"></div>
        </template>
      </div>
      
      <div id="sliderKnob" core-flow core-align="center" core-justify="center" 
          class="ring {{ {pin : pin, snaps : snaps} | tokenList }}" 
          on-pointerdown="{{expandKnob}}" on-tap="{{resetKnob}}" 
          on-trackstart="{{trackStart}}" on-track="{{track}}" on-trackend="{{trackEnd}}">
          
        <div id="sliderKnobInner" value="{{_value}}"></div>
        
      </div>
      
    </div>

  </template>
  
  <script>

    Polymer('paper-slider', {

      /**
       * The number that represents the current slider value.
       *
       * @attribute value
       * @type number
       * @default 0
       */
      value: 0,
      
      /**
       * The number that indicates the minimum value of the range.
       *
       * @attribute min
       * @type number
       * @default 0
       */
      min: 0,
      
      /**
       * he number that indicates the maximum value of the range.
       *
       * @attribute max
       * @type number
       * @default 100
       */
      max: 100,
      
      /**
       * Specifies the value granularity of the slider’s value.
       *
       * @attribute step
       * @type number
       * @default 1
       */
      step: 1,
      
      /**
       * If true, the slider thumb snaps to tick marks evenly spaced based
       * on the `step` property value.
       *
       * @attribute snaps
       * @type boolean
       * @default false
       */
      snaps: false,
      
      /**
       * If true, a pin with numeric value label is shown when the slider thumb 
       * is pressed.  Use for settings for which users need to know the exact 
       * value of the setting.
       *
       * @attribute pin
       * @type boolean
       * @default false
       */
      pin: false,
      
      /**
       * If true, this slider is disabled.  A disabled slider cannot be tapped
       * or dragged to change the slider value.
       *
       * @attribute disabled
       * @type boolean
       * @default false
       */
      disabled: false,
      
      attached: function() {
        this._w = this.$.sliderBar.offsetWidth;
      },
      
      valueChanged: function() {
        this.positionKnob(this.getPositionFromValue(this.value));
      },
      
      calcStep: function(value) {
        return (Math.round(value / this.step) * this.step);
      },
      
      calcKnobPosition: function() {
        return (this.max - this.min) * this._x / this._w + this.min;
      },
      
      getPositionFromValue: function(value) {
        return (value - this.min) / (this.max - this.min) * this._w
      },
      
      expandKnob: function() {
        this.$.sliderKnob.classList.add('expand');
      },
      
      resetKnob: function() {
        this.$.sliderKnob.classList.remove('expand');
      },
      
      positionKnob: function(x) {
        this._x = x;
        var s =  this.$.sliderKnob.style;
        this._value = this.calcStep(this.calcKnobPosition());
        s.webkitTransform = s.transform = 'translate(' + (this.snaps ? 
            this.getPositionFromValue(this._value) : x) + 'px, 0)';
        this.$.sliderKnob.classList.toggle('ring', this._value <= this.min);
      },
      
      trackStart: function(e) {
        this._startx = this._x || 0;
        this.$.sliderKnob.classList.add('dragging');
        e.preventTap();
      },

      track: function(e) {
        this.positionKnob(Math.min(this._w, Math.max(0, this._startx + e.dx)));
      },
      
      trackEnd: function() {
        this.$.sliderKnob.classList.remove('dragging');
        this.resetKnob();
        this.value = this.calcStep(this.calcKnobPosition());
      },
      
      barTap: function(e) {
        var rect = this.$.sliderBar.getBoundingClientRect();
        this.positionKnob(e.x - rect.left);
        this.value = this.calcStep(this.calcKnobPosition());
      },
      
      snapsChanged: function() {
        this.markers = [], l = (this.max - this.min) / this.step;
        for (var i = 0; i < l; i++) {
          this.markers.push('');
        }
      }

    });

  </script>

</polymer-element>
